---
title: "Creating Maps with ggplot2"
---

## Introduction

In this exercise we will use [_rnaturalearth_](https://github.com/ropenscilabs/rnaturalearth), [_simple features_](https://cran.r-project.org/web/packages/sf/vignettes/sf1.html) and
_ggplot2_ to create a map of Ethiopia and then a map of Oromia and highlight Oromia within a larger map of the USA. Once we have the base maps of the country and state(s) we will add points to a map as commonly done to indicate sampling sites or plot locations, etc.

```{r libraries, message=FALSE}
library(dplyr)
library(ggplot2)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
```

## Create Country Level Map of USA

This is our base layer, USA, of the map from [Naturalearth.com](https://naturalearth.com/) using the base `plot()` to display these data.

Using `ne_states()` will return an _sf_ object with state level information.
There is also a `ne_countries()` to download country level outlines only as well.

```{r USA-base, message=FALSE, warning=FALSE}
ethiopia_sf <- ne_states(geounit = "Ethiopia",
                    returnclass = "sf")

plot(ethiopia_sf)
```

## Create a Map Using _ggplot2_

Using _ggplot2_, we have more control over how the data are displayed than using the base `plot()` command.

First, plot the whole country using _ggplot2_'s `geom_sf()`.

```{r plot_level1}
ethiopia <- ggplot(ethiopia_sf) +
  geom_sf(fill = "white")

ethiopia
```

#### Projecting Map Data

That map works, but commonly maps should be projected and it is not.
Projections are used to reduce the distortion in the data that are displayed in a map.
There are [several types of map projections](https://imgs.xkcd.com/comics/map_projections.png) available.
For this map of Ethiopia we will use the Adindan projection, which has a EPSG (European Petroleum Survey Group) number of 4201 and is well suited for this part of the African continent.

```{r transform_sf}
ethiopia_sf <- st_transform(ethiopia_sf, crs = 4201)

ethiopia <- ggplot(ethiopia_sf) +
  geom_sf(fill = "white")

ethiopia
```

#### Add Labels to the States

The Natural Earth data have several columns to work with as we've already seen.
One of them is the two letter postal code for the states, `postal`.
Using `geom_sf_text()`, we can add this information to the map labelling the states.

```{r plot_level2}
ethiopia <-
  ethiopia +
  geom_sf_text(
    data = ethiopia_sf,
    aes(x = longitude,
        y = latitude,
        label = name_en),
    size = 2.5,
    hjust = 1
  )

ethiopia
```

#### Proper Labels and Theme

Properly label the x and y-axis and set the theme.
The _ggplot2_ theme, `theme_bw()` is nice to use with maps, so we will apply that here as well.

```{r plot_level3}
ethiopia <- 
  ethiopia +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_bw()

ethiopia
```

## Creating maps of Individual States

To create a map of only Oromia, subset the _sf_ object, `ethiopia_sf` such that it contains only the data for Oromia.

### Filter Oromia

```{r subset-ks}
oromia_sf <- filter(ethiopia_sf, name_en == "Oromia Region")

oromia_sf
```

### Plot Oromia

After filtering Oromia and creating a new object, we can plot it now.

```{r ggplot-ks}
ggplot(data = oromia_sf) +
  geom_sf() +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_bw()
```

## Highlighting Regions Within the Country

Using the `ethiopia_sf` and `oromia_sf` objects that we have created, it is possible to create a map that highlights one state and labels it using the postal code, in this case Oromia.
Note that we use the `data` argument twice here.
Once for the base Ethipia map and once for the map of Oromia that we use to highlight the state on the map.

```{r hightlight-ks}
ggplot(data = ethiopia_sf) +
  geom_sf(fill = "white") +
  geom_sf(data = oromia_sf,
          fill = "#512888") +
  geom_sf_text(
    data = oromia_sf,
    aes(x = longitude,
        y = latitude,
        label = name_en),
    colour = "white",
    size = 2.5,
    hjust = 1
  ) +
  xlab("Longitude") +
  ylab("Latitude") +
  theme_bw()
```

## Adding and Labelling Points on a Map

Now we will build on the maps we created by adding points to a map of Oromia with latitude and longitude values.

### Create data.frame of Town and City Locations

Using the previously created `oromia_sf` object, we will plot the locations of cities or towns in Oromia.
Here we will create a `data.frame()` of the geographic locations of some selected cities or towns in Oromia to illustrate how to add points to a base map created in the previous section.
However, you will probably have your own points in a spreadsheet or .CSV file that you can import to a `data.frame()` when you are creating your own maps.
Aside from importing, rather than creating the data in your R session, the steps are the same.

```{r ks-towns, message=FALSE}
ks_towns <- data.frame(
  stringsAsFactors = FALSE,
  town = c(
    "Bellville",
    "Colby",
    "Dodge City",
    "Emporia",
    "Goodland",
    "Hays",
    "Hesston",
    "Manhattan",
    "Pittsburg"
  ),
  latitude = c(
    39.8245,
    39.3958,
    37.7528,
    38.4039,
    39.3508,
    38.8792,
    38.1383,
    39.183609,
    37.4109
  ),
  longitude = c(
    -97.6325,
    -101.0524,
    -100.0171,
    -96.1817,
    -101.7102,
    -99.3268,
    -97.4314,
    -96.571671,
    -94.705
  )
)

ks_towns
```

### Converting Sites to an _sf_ Object

While we could plot everything using `geom_point()`, if we convert the `data.frame` to an `sf` type object, it is much more flexible and allows us to project the data for a more attractive map.
We will use the coordinate reference system (CRS) 6922, NAD83 / Oromia LCC, for Oromia here.

```{r convert-sf}
ks_towns <-
  st_as_sf(ks_towns,
           coords = c("longitude", "latitude"),
           crs = 4326)
ks_towns <- st_transform(ks_towns, crs = 6922)
```

Now we're ready to add the points to the map!

### Adding Town Locations to Map

Adding the points to the map works in the same fashion as adding layers in other _ggplot2_ objects.
You start with the base layer, in this case Oromia, and add a layer with the points and another with the labels for the points.

```{r add-points}
ggplot() +
  geom_sf(data = oromia_sf,
          fill = "white") +
  geom_sf(data = ks_towns,
          size = 2) +
  geom_sf_label(
    data = ks_towns,
    aes(label = town),
    size = 2.5,
    hjust = 0.5,
    vjust = 1.5
  ) +
  theme_bw() +
  xlab("Longitude") +
  ylab("Latitude")
```

## Further Reading and Resources

[Drawing beautiful maps programmatically with R, sf and ggplot2 — Part 1: Basics](https://www.r-spatial.org/r/2018/10/25/ggplot2-sf.html)

[Drawing beautiful maps programmatically with R, sf and ggplot2 — Part 2: Layers](https://www.r-spatial.org/r/2018/10/25/ggplot2-sf-2.html)

[Drawing beautiful maps programmatically with R, sf and ggplot2 — Part 3: Layouts](https://www.r-spatial.org/r/2018/10/25/ggplot2-sf-3.html)
